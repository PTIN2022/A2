openapi: 3.0.0
info:
  title: API portal de gestion
  version: '1.0'
servers:
  - url: http://127.0.0.1:8080/
    description: Developments
  - url: http://craaxkvm.epsevg.upc.es:23701/
    description: Server
paths:
  # reservas
  /reservas:
    get:
      summary: Obtiene todas las reservas de todos los clientes (no me uses)
      tags:
        - Reservas
      responses:
          '200':
            description: Peticion correcta
            content:
              application/json:
                examples:
                  Meter reserva:
                    value:  >-
                        [
                          {
                            "fecha_entrada": "2022-04-18T11:00:00",
                            "fecha_salida": "2022-04-18T18:00:00",
                            "id_cargador": 1,
                            "id_cliente": "1238712N",
                            "id_reserva": 1,
                            "id_vehiculo": "LKE2378"
                          }
                        ]
          '400':
            description: Peticion incorrecta
            content:
              application/json:
                examples:
                  Error al meter reserva:
                    value: >-
                      {"error": "Malformed request syntax."}
                      
    # mandamos/resolvemos 1 reserva]
    post:
      summary: Inserta una nueva reserva
      tags:
      - Reservas
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                  - id_estacion
                  - fecha_inicio
                  - fecha_final
                  - id_vehiculo
                  - id_cliente
              properties:
                id_estacion:
                  type: integer
                fecha_inicio:
                  type: string
                fecha_final:
                  type: string
                id_vehiculo:
                  type: string
                id_cliente:
                  type: string
              example:
                id_estacion: 1
                fecha_inicio: "18-04-2022 11:00"
                fecha_final: "18-04-2022 18:00"
                id_vehiculo: "LKE2378"
                id_cliente: "1238712N"
      responses:
        '200':
          description: Peticion correcta
          content:
            application/json:
              examples:
                Meter reserva:
                  value:  >-
                      {
                        "id_cliente": "1238712N",
                        "fecha_entrada": "2022-04-18T18:00:00",
                        "fecha_salida": "2022-04-18T11:00:00",
                        "id_reserva": 1,
                        "id_estacion": 1,
                        "id_vehiculo": "LKE2378",
                        "id_cargador": 2
                      }
        '400':
          description: Peticion incorrecta
          content:
            application/json:
              examples:
                Error al meter reserva:
                  value: >-
                    {"error": "Malformed request syntax."}
  /reservas/estacion/{id_estacion}:
    # pedimos una lista de reservas por una estacion dada
    get:
      summary: Obtiene una lista de reservas para una estacion dada obtiene solo las reservas desde ahora al futuro
      tags:
      - Reservas
      parameters:
        - in: path
          name: id_estacion
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Obtiene un lista de reservas por estacion desde la fecha actual al futuro
          content:
            application/json:
              examples:
                Con reservas:
                  value: >-
                        [
                          {
                            "fecha_entrada": "2022-07-18T11:00:00",
                            "fecha_salida": "2022-07-18T18:00:00",
                            "id_cargador": 1,
                            "id_cliente": "1238712N",
                            "id_reserva": 1,
                            "id_vehiculo": "LKE2378"
                          },
                          {
                            "fecha_entrada": "2022-07-18T12:00:00",
                            "fecha_salida": "2022-07-18T115:00:00",
                            "id_cargador": 2,
                            "id_cliente": "1238712N",
                            "id_reserva": 2,
                            "id_vehiculo": "LKE2378"
                          }
                        ]
                Sin reservas:
                  value: '[]'
        '401':
          description: Not login
          content:
            application/json:
              examples:
                error:
                  value: >-
                    {"error": "User not authenticated."}
  /reservas/bydni/{dni}:
    # pedimos una lista de reservas por un dni dado
    get:
      summary: Obtiene una lista de reservas para un dni dado
      tags:
      - Reservas
      parameters:
        - in: path
          name: dni
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Obtiene un lista de reservas
          content:
            application/json:
              examples:
                Con reservas:
                  value: >-
                        [
                          {
                            "fecha_entrada": "2022-07-18T11:00:00",
                            "fecha_salida": "2022-07-18T18:00:00",
                            "id_cargador": 1,
                            "id_cliente": "1238712N",
                            "id_reserva": 1,
                            "id_vehiculo": "LKE2378"
                          },
                          {
                            "fecha_entrada": "2022-07-18T12:00:00",
                            "fecha_salida": "2022-07-18T115:00:00",
                            "id_cargador": 2,
                            "id_cliente": "1238712N",
                            "id_reserva": 2,
                            "id_vehiculo": "LKE2378"
                          }
                        ]
                Sin reservas:
                  value: '[]'
        '401':
          description: Not login
          content:
            application/json:
              examples:
                error:
                  value: >-
                    {"error": "User not authenticated."}
  /reservas/bymatricula/{matricula}:
    # pedimos una lista de reservas por una matriculña dada
    get:
      summary: Obtiene una lista de reservas para una matricula dada
      tags:
      - Reservas
      parameters:
        - in: path
          name: matricula
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Obtiene un lista de reservas
          content:
            application/json:
              examples:
                Con reservas:
                  value: >-
                        [
                          {
                            "fecha_entrada": "2022-07-18T11:00:00",
                            "fecha_salida": "2022-07-18T18:00:00",
                            "id_cargador": 1,
                            "id_cliente": "1238712N",
                            "id_reserva": 1,
                            "id_vehiculo": "LKE2378"
                          },
                          {
                            "fecha_entrada": "2022-07-18T12:00:00",
                            "fecha_salida": "2022-07-18T115:00:00",
                            "id_cargador": 2,
                            "id_cliente": "1238712N",
                            "id_reserva": 2,
                            "id_vehiculo": "LKE2378"
                          }
                        ]
                Sin reservas:
                  value: '[]'
        '401':
          description: Not login
          content:
            application/json:
              examples:
                error:
                  value: >-
                    {"error": "User not authenticated."}
  /reservas/{id}:
      # pedimos una reserva, dado su id
      get:
        summary: Obtiene una reserva por un id dado
        tags:
          - Reservas
        parameters:
          - in: path
            name: id
            required: true
            schema:
              type: integer
        responses:
          '200':
            description: Default error sample response
            content:
              application/json:
                examples:
                  Reservas:
                    value:  >-
                        {
                          "fecha_entrada": "2022-04-18T11:00:00",
                          "fecha_salida": "2022-04-18T18:00:00",
                          "id_cargador": 1,
                          "id_cliente": "1238712N",
                          "id_reserva": 1,
                          "id_vehiculo": "LKE2378"
                        }
          '401':
            description: Not login
            content:
              application/json:
                examples:
                  error:
                    value: >-
                        {"error": "User not authenticated."}

          '404':
            description: Not found
            content:
              application/json:
                examples:
                  error:
                    value: >-
                        {"error": "Reserva not found."}

      #borrar reserva
      delete:
        summary: Elimina reserva por ID
        tags:
          - Reservas
        parameters:
          - in: path
            name: id
            required: true
            schema:
              type: integer
        responses:
          '200':
            description: Eliminado delete
            content:
              application/json:
                examples:
                  Reservas:
                    value: {"msg": "Data deleted correctly."}
                  Reserva no encontrada:
                    value: '[]'
          '401':
            description: Not login
            content:
              application/json:
                examples:
                  error:
                    value: >-
                      {"error": "User not authenticated."}
          '404':
            description: Not Found
            content:
              application/json:
                examples:
                  error:
                    value: >-
                      {"error": "Reserva not found."}

#########################################################################################
  /promociones:
    # pedimos una lista de promociones
    get:
      summary: Obtiene una lista de promociones
      tags:
      - Promociones
      responses:
        '200':
          description: Peticion correcta
          content:
            application/json:
              examples:
                Con promociones:
                  value: >-
                    [
                      {
                        "descripcion": "20% de descuento en la electrolinera de Vilanova!",
                        "descuento": 20,
                        "estado": true,
                        "fecha_inicio": "2022-04-18T11:00:00",
                        "fecha_fin": "2022-04-18T21:00:00",
                        "cantidad_usados": 500,
                        "id_promo": 1
                      },
                      {
                        "descripcion": "20% de descuento en la electrolinera de Barcelona!",
                        "descuento": 15,
                        "estado": false,
                        "fecha_inicio": "2022-04-18T17:00:00",
                        "fecha_fin": "2022-04-18T22:00:00",
                        "cantidad_usados": 500,
                        "id_promo": 2
                      },
                      {
                        "descripcion": "20% de descuento en la electrolinera de Sitges!",
                        "descuento": 25,
                        "estado": true,
                        "fecha_inicio": "2022-04-18T10:00:00",
                        "fecha_fin": "2022-04-18T19:00:00",
                        "cantidad_usados": 500,
                        "id_promo": 3
                      }
                    ]
                Sin promociones:
                  value: '[]'
    post:
      summary: Inserta un nueva promocion
      tags:
      - Promociones
      requestBody:
          required: true
          content:
            multipart/form-data:
              schema:
                type: object
                required:
                  - descripcion
                  - descuento
                  - estado
                  - fecha_inicio
                  - fecha_fin
                properties:
                  descuento:
                    type: integer
                  fecha_inicio:
                    type: string
                  fecha_fin:
                    type: string
                  descripcion:
                    type: string
                  estado:
                    type: boolean
      responses:
        '200':
          description: Peticion correcta
          content:
            application/json:
              examples:
                Insertar nueva promocion:
                  value: >-
                    {
                      "descripcion": "20% de descuento en la electrolinera de Sitges!",
                      "descuento": 25,
                      "estado": true,
                      "fecha_inicio": "2022-04-18T10:00:00",
                      "fecha_fin": "2022-04-18T19:00:00",
                      "id_promo": 3
                    }
        '400':
          description: Peticion incorrecta
          content:
            application/json:
              examples:
                Mala formada peticion:
                  value: {"error": "Malformed request syntax."}
        '403':
          description: Denied access
          content:
            application/json:
              examples:
                Usuario no autorizado:
                  value: {"error": "Denied access"}
  /promociones/{id_promocion}:
    # pedimos una reserva, dado su id
      get:
        summary: Obtiene una promocion en funcion de su id promocion
        tags:
          - Promociones
        parameters:
          - in: path
            name: id_promocion
            required: true
            schema:
              type: integer
        responses:
          '200':
            description: Devolvemos la promocion de su id correspodiente
            content:
              application/json:
                examples:
                  Promociones:
                    value:  >-
                      {"id_promo":1,"descuento":10,"cantidad_cupones":100,"cantidad_usados":20,"fecha_inicio":"2022-05-14","fecha_fin":"2022-06-18","estado":true,"descripcion":"Por la ignauracion de la electrolinera"}
          '400':
            description: Peticion incorrecta
            content:
              application/json:
                examples:
                  Mala formada peticion:
                    value: {"error": "Malformed request syntax."}
          '401':
            description: Not login
            content:
              application/json:
                examples:
                  Usuario no auntenticado:
                    value: {"error": "User not authenticated."}
          '403':
            description: Acceso no autorizado
            content:
              application/json:
                examples:
                  Acceso denegado:
                    value: {"error": "Denied access"}
          '404':
            description: Not found
            content:
              application/json:
                examples:
                  Promocion no encontrado: 
                    value: {"error": "Promociones not found."}
      # modificar una promocion dado su id
      put:
        summary: Modifica una promocion
        tags:
          - Promociones
        parameters:
          - in: path
            name: id_promocion
            required: true
            schema:
              type: integer
        requestBody:
          required: true
          content:
            multipart/form-data:
              schema:
                type: object
                properties:
                  estado:
                    type: boolean
                  descuento:
                    type: integer
                  fecha_inicio:
                    type: string
                  fecha_fin:
                    type: string
                  descripcion:
                    type: string
        responses:
          '200':
            description: Peticion correcta
            content:
              application/json:
                examples:
                  Trabajador actualizado:
                    value: >-
                        {
                          "descripcion": "20% de descuento en la electrolinera de Sitges!",
                          "descuento": 25,
                          "estado": true,
                          "fecha_inicio": "2022-04-18T10:00:00",
                          "fecha_fin": "2022-04-18T19:00:00",
                          "id_promo": 3
                        }
          '400':
              description: Peticion incorrecta
              content:
                application/json:
                  examples:
                    Peticion mal formateada:
                      value: {"error": "Malformed request syntax."}
          '403':
              description: Denied access
              content:
                application/json:
                  examples:
                    Usuario no identificado:
                      value: {"error": "User not authenticated."}
          '404':
              description: Not Found
              content:
                application/json:
                  examples:
                    Promocion no encontrada:
                      value: {"error": "Promocion not found."}
      delete:
        summary: Eliminar una promcion dado su id
        tags:
          - Promociones
        parameters:
          - in: path
            name: id_promocion
            required: true
            schema:
              type: integer
        responses:
            '200':
              description: Peticion correcta
              content:
                application/json:
                  examples:
                    Promocion:
                      value: {"msg": "Promocion deleted succesfully"}
            '400':
              description: Peticion incorrecta
              content:
                application/json:
                  examples:
                    Peticion mal formateada:
                      value: {"error": "Malformed request syntax."}
            '403':
              description: Denied access
              content:
                application/json:
                  examples:
                    Usuario no identificado:
                      value: {"error": "User not authenticated."}
            '404':
              description: Not Found
              content:
                application/json:
                  examples:
                    error:
                      value: {"error": "Promocion not found."}
            '410':
              description: Peticion correcta
              content:
                application/json:
                  examples:
                    Promocion:
                      value: {"msg": "Promocion deleted succesfully"}
  /promociones/{estado}:
    # pedimos una lista de promociones dado su estado (activa/inactiva)
    get:
      summary: Obtiene información una lista de promociones de ese estado
      tags:
      - Promociones
      parameters:
      - in: path
        name: estado
        required: true
        schema:
          type: boolean
      responses:
        '200':
          description: Peticion correcta
          content:
            application/json:
              examples:
                Con promociones activas:
                  value: >-
                      [
                        {
                          "descripcion": "20% de descuento en la electrolinera de Vilanova!",
                          "descuento": 20,
                          "estado": true,
                          "fecha_inicio": "2022-04-18T11:00:00",
                          "fecha_fin": "2022-04-18T21:00:00",
                          "id_promo": 1
                        },
                        {
                          "descripcion": "20% de descuento en la electrolinera de Sitges!",
                          "descuento": 25,
                          "estado": true,
                          "fecha_inicio": "2022-04-18T10:00:00",
                          "fecha_fin": "2022-04-18T19:00:00",
                          "id_promo": 3
                        }
                      ]
                Sin promociones activas:
                  value: >-
                      [
                        {
                          "descripcion": "20% de descuento en la electrolinera de Barcelona!",
                          "descuento": 15,
                          "estado": false,
                          "fecha_inicio": "2022-04-18T17:00:00",
                          "fecha_fin": "2022-04-18T22:00:00",
                          "id_promo": 2
                        }
                      ]
                Sin promociones:
                  value: '[]'
        '400':
          description: Peticion incorrecta
          content:
            application/json:
              examples:
                Error al meter incidencia:
                  value: {"error": "Malformed request syntax."}
        '403':
          description: Denied access
          content:
            application/json:
              examples:
                Usuario no identificado:
                  value: {"error": "User not authenticated."}
  /promociones/estacion:
    # pedimos una reserva, dado su id
      get:
        summary: Obtiene una lista de promociones en funcion de su id estaciones
        tags:
          - Promociones
        responses:
          '200':
            description: Por defecto sacamos una lista de promociones de cada estacion
            content:
              application/json:
                examples:
                  Promociones:
                    value:  >-
                      [{"id_estacion" : 2,"Nombre_est": "e-Barcelo","latitud" : "260º 23' 45''","longitud": "255º 23' 45''","capacidad": "64 plazas","direccion": "C/ Victor i Balaguer 5","potencia_contratada" : "6 Mwh","zona": "EB2","ocupacion_actual": "vacia","potencia_usada": "5.288 Mwh","telefono": "93555228866","ciudad": "Barcelona","pais": "España","promociones": [{"id_promo":1,"descuento":10,"cantidad_cupones":100,"cantidad_usados":20,"fecha_inicio":"2022-05-14","fecha_fin":"2022-06-18","estado":true,"descripcion":"Por la ignauracion de la electrolinera"},{"id_promo":2,"descuento":11,"cantidad_cupones":75,"cantidad_usados":2,"fecha_inicio":"2022-05-14","fecha_fin":"2022-06-18","estado":true,"descripcion":"La promocion se consigue mediante por sorteo"}]},{"id_estacion" : 1,"Nombre_est": "ElectroVilanova","latitud" : "233º 23' 45''","longitud": "233º 23' 45''","capacidad": "64 plazas","direccion": "C/ Victor i Balaguer 5","potencia_contratada" : "3 Mwh","zona": "VB1","ocupacion_actual": "alta","potencia_usada": "2.5 Mwh","telefono": "93555228866","ciudad": "Vilanova i la Geltru","pais": "España","promociones": [{"id_promo":1,"descuento":10,"cantidad_cupones":100,"cantidad_usados":20,"fecha_inicio":"2022-05-14","fecha_fin":"2022-06-18","estado":true,"descripcion":"Por la ignauracion de la electrolinera"},{"id_promo":2,"descuento":11,"cantidad_cupones":75,"cantidad_usados":2,"fecha_inicio":"2022-05-14","fecha_fin":"2022-06-18","estado":true,"descripcion":"La promocion se consigue mediante por sorteo"}]},{"id_estacion" : 3,"Nombre_est": "Electrolinera industrial Vilanova","latitud" : "233º 25' 59''","longitud": "233º 23' 45''","capacidad": "64 plazas","direccion": "Av./ Eduard Toldrà 5","potencia_contratada" : "3 Mwh","zona": "VB1","ocupacion_actual": "alta","potencia_usada": "2.5 Mwh","telefono": "93555228866","ciudad": "Vilanova i la Geltru","pais": "España","promociones": [{"id_promo":1,"descuento":10,"cantidad_cupones":100,"cantidad_usados":20,"fecha_inicio":"2022-05-14","fecha_fin":"2022-06-18","estado":true,"descripcion":"Por la ignauracion de la electrolinera"},{"id_promo":2,"descuento":11,"cantidad_cupones":75,"cantidad_usados":2,"fecha_inicio":"2022-05-14","fecha_fin":"2022-06-18","estado":true,"descripcion":"La promocion se consigue mediante por sorteo"}]}]
                  No_promociones:
                    value: '[]'
          '401':
            description: Not login
            content:
              application/json:
                examples:
                  error:
                    value: >-
                        {"error": "User not authenticated."}
          '404':
            description: Not found
            content:
              application/json:
                examples:
                  error:
                    value: >-
                        {"error": "Promociones not found."}
  /promociones/{id_estacion}:
  # pedimos una reserva, dado su id
    get:
      summary: Obtiene una lista de promociones en funcion de su id estaciones
      tags:
        - Promociones
      parameters:
        - in: path
          name: id_estacion
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Por defecto sacamos una lista de promociones
          content:
            application/json:
              examples:
                Promociones:
                  value:  >-
                    {"id_estacion" : 1,"Nombre_est": "ElectroVilanova","latitud" : "233º 23' 45''","longitud": "233º 23' 45''","capacidad": "64 plazas","direccion": "C/ Victor i Balaguer 5","potencia_contratada" : "3 Mwh","zona": "VB1","ocupacion_actual": "alta","potencia_usada": "2.5 Mwh","telefono": "93555228866","ciudad": "Vilanova i la Geltru","pais": "España","promociones": [{"id_promo":1,"descuento":10,"cantidad_cupones":100,"cantidad_usados":20,"fecha_inicio":"2022-05-14","fecha_fin":"2022-06-18","estado":true,"descripcion":"Por la ignauracion de la electrolinera"},{"id_promo":2,"descuento":11,"cantidad_cupones":75,"cantidad_usados":2,"fecha_inicio":"2022-05-14","fecha_fin":"2022-06-18","estado":true,"descripcion":"La promocion se consigue mediante por sorteo"}]}
                No_promociones:
                  value: '[]'
        '401':
          description: Not login
          content:
            application/json:
              examples:
                error:
                  value: >-
                      {"error": "User not authenticated."}
        '404':
          description: Not found
          content:
            application/json:
              examples:
                error:
                  value: >-
                      {"error": "Promociones not found."}
